<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>MAINHEALTH • parafac4microbiome</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="MAINHEALTH">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">parafac4microbiome</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/AP.html">GOHTRANS</a></li>
    <li><a class="dropdown-item" href="../articles/Fujita2023.html">Fujita2023</a></li>
    <li><a class="dropdown-item" href="../articles/GOHTRANS.html">GOHTRANS</a></li>
    <li><a class="dropdown-item" href="../articles/Introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/MAINHEALTH.html">MAINHEALTH</a></li>
    <li><a class="dropdown-item" href="../articles/Shao2019.html">Shao2019</a></li>
    <li><a class="dropdown-item" href="../articles/TIFN2.html">TIFN2</a></li>
    <li><a class="dropdown-item" href="../articles/vanderPloeg2024.html">vanderPloeg2024</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/GRvanderPloeg/parafac4microbiome/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>MAINHEALTH</h1>
            
            <h4 data-toc-skip class="date">2025-05-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/GRvanderPloeg/parafac4microbiome/blob/master/vignettes/articles/MAINHEALTH.Rmd" class="external-link"><code>vignettes/articles/MAINHEALTH.Rmd</code></a></small>
      <div class="d-none name"><code>MAINHEALTH.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="preamble">Preamble<a class="anchor" aria-label="anchor" href="#preamble"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dplyr'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter, lag</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     intersect, setdiff, setequal, union</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://grvanderploeg.com/parafac4microbiome/" class="external-link">parafac4microbiome</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/GRvanderPloeg/NPLStoolbox" class="external-link">NPLStoolbox</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://grvanderploeg.com/CMTFtoolbox/" class="external-link">CMTFtoolbox</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'CMTFtoolbox'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:NPLStoolbox':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     npred</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:parafac4microbiome':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     fac_to_vect, reinflateFac, reinflateTensor, vect_to_fac</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/trevorld/ggpattern" class="external-link">ggpattern</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">testMetadata</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">comp</span>, <span class="va">metadata</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">transformedSubjectLoadings</span> <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="va">Fac</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">comp</span><span class="op">]</span></span>
<span>  <span class="va">transformedSubjectLoadings</span> <span class="op">=</span> <span class="va">transformedSubjectLoadings</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/norm.html" class="external-link">norm</a></span><span class="op">(</span><span class="va">transformedSubjectLoadings</span>, <span class="st">"2"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">result</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">transformedSubjectLoadings</span> <span class="op">~</span> <span class="va">BMI</span> <span class="op">+</span> <span class="va">C.section</span> <span class="op">+</span> <span class="va">Secretor</span> <span class="op">+</span> <span class="va">Lewis</span> <span class="op">+</span> <span class="va">whz.6m</span>, data<span class="op">=</span><span class="va">metadata</span><span class="op">$</span><span class="va">mode1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Extract coefficients and confidence intervals</span></span>
<span>  <span class="va">coef_estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span></span>
<span>  <span class="va">conf_intervals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Remove intercept</span></span>
<span>  <span class="va">coef_estimates</span> <span class="op">&lt;-</span> <span class="va">coef_estimates</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">coef_estimates</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"(Intercept)"</span>, <span class="op">]</span></span>
<span>  <span class="va">conf_intervals</span> <span class="op">&lt;-</span> <span class="va">conf_intervals</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">conf_intervals</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"(Intercept)"</span>, <span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Combine into a clean data frame</span></span>
<span>  <span class="va">summary_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    Term     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">coef_estimates</span><span class="op">)</span>,</span>
<span>    Estimate <span class="op">=</span> <span class="va">coef_estimates</span><span class="op">[</span>, <span class="st">"Estimate"</span><span class="op">]</span> <span class="op">*</span> <span class="fl">1e3</span>,</span>
<span>    CI       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>                 <span class="va">conf_intervals</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="st">" – "</span>,</span>
<span>                 <span class="va">conf_intervals</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>               <span class="op">)</span>,</span>
<span>    P_value  <span class="op">=</span> <span class="va">coef_estimates</span><span class="op">[</span>, <span class="st">"Pr(&gt;|t|)"</span><span class="op">]</span>,</span>
<span>    P_adjust <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="va">coef_estimates</span><span class="op">[</span>, <span class="st">"Pr(&gt;|t|)"</span><span class="op">]</span>, <span class="st">"BH"</span><span class="op">)</span>,</span>
<span>    row.names <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">summary_table</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Old approach</span></span>
<span><span class="co"># Needed colours: BMI groups (3) and phyla levels (6)</span></span>
<span><span class="co"># colours = hue_pal()(9)</span></span>
<span><span class="co"># #show_col(colours)</span></span>
<span><span class="co"># BMI_cols = colours[c(1,4,7)]</span></span>
<span><span class="co"># phylum_cols = colours[-c(1,4,7)]</span></span>
<span></span>
<span><span class="co"># Rasmus's suggestion</span></span>
<span><span class="va">colours</span> <span class="op">=</span> <span class="fu">RColorBrewer</span><span class="fu">::</span> <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">8</span>, <span class="st">"Dark2"</span><span class="op">)</span></span>
<span><span class="va">BMI_cols</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>,<span class="st">"darkgoldenrod"</span>,<span class="st">"darkred"</span><span class="op">)</span> <span class="co">#colours[1:3]</span></span>
<span><span class="va">WHZ_cols</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"darkgoldenrod"</span>, <span class="st">"dodgerblue4"</span><span class="op">)</span></span>
<span><span class="va">phylum_cols</span> <span class="op">=</span> <span class="va">colours</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">processedFaeces</span> <span class="op">=</span> <span class="fu">parafac4microbiome</span><span class="fu">::</span><span class="fu"><a href="../reference/processDataCube.html">processDataCube</a></span><span class="op">(</span><span class="fu">NPLStoolbox</span><span class="fu">::</span><span class="va"><a href="http://grvanderploeg.com/NPLStoolbox/reference/Jakobsen2025.html" class="external-link">Jakobsen2025</a></span><span class="op">$</span><span class="va">faeces</span>, sparsityThreshold <span class="op">=</span> <span class="fl">0.75</span>, centerMode<span class="op">=</span><span class="fl">1</span>, scaleMode<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">processedMilk</span> <span class="op">=</span> <span class="fu">parafac4microbiome</span><span class="fu">::</span><span class="fu"><a href="../reference/processDataCube.html">processDataCube</a></span><span class="op">(</span><span class="fu">NPLStoolbox</span><span class="fu">::</span><span class="va"><a href="http://grvanderploeg.com/NPLStoolbox/reference/Jakobsen2025.html" class="external-link">Jakobsen2025</a></span><span class="op">$</span><span class="va">milkMicrobiome</span>, sparsityThreshold<span class="op">=</span><span class="fl">0.85</span>, centerMode<span class="op">=</span><span class="fl">1</span>, scaleMode<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">processedMilkMetab</span> <span class="op">=</span> <span class="fu">parafac4microbiome</span><span class="fu">::</span><span class="fu"><a href="../reference/processDataCube.html">processDataCube</a></span><span class="op">(</span><span class="fu">NPLStoolbox</span><span class="fu">::</span><span class="va"><a href="http://grvanderploeg.com/NPLStoolbox/reference/Jakobsen2025.html" class="external-link">Jakobsen2025</a></span><span class="op">$</span><span class="va">milkMetabolomics</span>, CLR<span class="op">=</span><span class="cn">FALSE</span>, centerMode<span class="op">=</span><span class="fl">1</span>, scaleMode<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-selection">Model selection<a class="anchor" aria-label="anchor" href="#model-selection"></a>
</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># assessment_faeces = parafac4microbiome::assessModelQuality(processedFaeces$data, numRepetitions = 10, numCores = 10)</span></span>
<span><span class="co"># assessment_milk = parafac4microbiome::assessModelQuality(processedMilk$data, numRepetitions = 10, numCores = 10)</span></span>
<span><span class="co"># assessment_milkMetab = parafac4microbiome::assessModelQuality(processedMilkMetab$data, numRepetitions = 10, numCores = 10)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># saveRDS(assessment_faeces, "./MAINHEALTH/assessment_faeces.RDS")</span></span>
<span><span class="co"># saveRDS(assessment_milk, "./MAINHEALTH/assessment_milk.RDS")</span></span>
<span><span class="co"># saveRDS(assessment_milkMetab, "./MAINHEALTH/assessment_milkMetab.RDS")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># assessment_faeces = readRDS("./assessment_faeces.RDS")</span></span>
<span><span class="co"># assessment_milk = readRDS("./assessment_milk.RDS")</span></span>
<span><span class="co"># assessment_milkMetab = readRDS("./assessment_milkMetab.RDS")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># assessment_faeces$plots$overview # 2 or 3 components</span></span>
<span><span class="co"># assessment_faeces$plots$TCC[[3]] # 3 components seems safe</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># assessment_milk$plots$overview # likely 3 components</span></span>
<span><span class="co"># assessment_milk$plots$TCC[[3]] # 3 components seems safe</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># assessment_milkMetab$plots$overview # 2 or 3 components, likely 3</span></span>
<span><span class="co"># assessment_milkMetab$plots$TCC[[3]] # 3 components seems safe</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># a = assessment_faeces$metrics$CORCONDIA %&gt;% as_tibble() %&gt;% mutate(index=1:nrow(.)) %&gt;% pivot_longer(-index) %&gt;% ggplot(aes(x=as.factor(name),y=value)) + geom_boxplot() + xlab("Number of components") + ylab("CORCONDIA") + theme(text=element_text(size=16))</span></span>
<span><span class="co"># b = assessment_milk$metrics$CORCONDIA %&gt;% as_tibble() %&gt;% mutate(index=1:nrow(.)) %&gt;% pivot_longer(-index) %&gt;% ggplot(aes(x=as.factor(name),y=value)) + geom_boxplot() + xlab("Number of components") + ylab("CORCONDIA") + theme(text=element_text(size=16))</span></span>
<span><span class="co"># c = assessment_milkMetab$metrics$CORCONDIA %&gt;% as_tibble() %&gt;% mutate(index=1:nrow(.)) %&gt;% pivot_longer(-index) %&gt;% ggplot(aes(x=as.factor(name),y=value)) + geom_boxplot() + xlab("Number of components") + ylab("CORCONDIA") + theme(text=element_text(size=16))</span></span>
<span><span class="co"># ggarrange(a,b,c)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># colourCols = c("", "", "")</span></span>
<span><span class="co"># legendTitles = c("BMI group", "Phylum", "")</span></span>
<span><span class="co"># xLabels = c("Subject index", "Feature index", "Time index")</span></span>
<span><span class="co"># legendColNums = c(3,5,0)</span></span>
<span><span class="co"># arrangeModes = c(TRUE, TRUE, FALSE)</span></span>
<span><span class="co"># continuousModes = c(FALSE,FALSE,TRUE)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># stability_faeces = parafac4microbiome::assessModelStability(processedFaeces, maxNumComponents=3, numFolds=20, colourCols=colourCols, legendTitles=legendTitles, xLabels = xLabels, legendColNums=legendColNums, arrangeModes=arrangeModes, numCores=parallel::detectCores())</span></span>
<span><span class="co"># stability_faeces$modelPlots[[2]]</span></span>
<span><span class="co"># stability_faeces$modelPlots[[3]]</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># stability_milk = parafac4microbiome::assessModelStability(processedMilk, maxNumComponents=3, numFolds=10, colourCols=colourCols, legendTitles=legendTitles, xLabels = xLabels, legendColNums=legendColNums, arrangeModes=arrangeModes, numCores=parallel::detectCores())</span></span>
<span><span class="co"># stability_milk$modelPlots[[2]]</span></span>
<span><span class="co"># stability_milk$modelPlots[[3]]</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># stability_milkMetab = parafac4microbiome::assessModelStability(processedMilkMetab, maxNumComponents=4, numFolds=10, colourCols=c("", "", ""), legendTitles=c("BMI group", "Class", ""), xLabels = xLabels, legendColNums=legendColNums, arrangeModes=arrangeModes, numCores=parallel::detectCores())</span></span>
<span><span class="co"># stability_milkMetab$modelPlots[[3]]</span></span>
<span><span class="co"># stability_milkMetab$modelPlots[[4]]</span></span>
<span></span>
<span><span class="co"># </span></span>
<span><span class="co"># stability_faeces$modelPlots[[3]] # 3 components seems ok</span></span>
<span><span class="co"># stability_milk$modelPlots[[3]] # 3 components very unstable</span></span>
<span><span class="co"># stability_milk$modelPlots[[2]] # 2 components still a bit unstable</span></span>
<span><span class="co"># stability_milkMetab$modelPlots[[3]] # 3 components ok</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># cp_faeces = parafac4microbiome::parafac(processedFaeces$data, nfac=3, nstart = 100)</span></span>
<span><span class="co"># cp_milk = parafac4microbiome::parafac(processedMilk$data, nfac=2, nstart = 100)</span></span>
<span><span class="co"># cp_milkMetab = parafac4microbiome::parafac(processedMilkMetab$data, nfac=3, nstart = 100)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># saveRDS(cp_faeces, "./MAINHEALTH/cp_faeces.RDS")</span></span>
<span><span class="co"># saveRDS(cp_milk, "./MAINHEALTH/cp_milk.RDS")</span></span>
<span><span class="co"># saveRDS(cp_milkMetab, "./MAINHEALTH/cp_milkMetab.RDS")</span></span>
<span></span>
<span><span class="va">cp_faeces</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"./MAINHEALTH/cp_faeces.RDS"</span><span class="op">)</span></span>
<span><span class="va">cp_milk</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"./MAINHEALTH/cp_milk.RDS"</span><span class="op">)</span></span>
<span><span class="va">cp_milkMetab</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"./MAINHEALTH/cp_milkMetab.RDS"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="faecal-microbiome">Faecal microbiome<a class="anchor" aria-label="anchor" href="#faecal-microbiome"></a>
</h2>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testMetadata</span><span class="op">(</span><span class="va">cp_faeces</span>, <span class="fl">1</span>, <span class="va">processedFaeces</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        Term   Estimate                                         CI    P_value</span></span>
<span><span class="co">## 1       BMI   1.557682 -0.00109277376368493 – 0.00420813678843941 0.24698916</span></span>
<span><span class="co">## 2 C.section -17.096372   -0.0655708277484862 – 0.0313780847296313 0.48646498</span></span>
<span><span class="co">## 3  Secretor  11.375601   -0.0221113148908448 – 0.0448625169392564 0.50262459</span></span>
<span><span class="co">## 4     Lewis -86.360039   -0.181248173947069 – 0.00852809560447294 0.07407419</span></span>
<span><span class="co">## 5    whz.6m  -3.321885   -0.0160020917474101 – 0.0093583227214069 0.60504067</span></span>
<span><span class="co">##    P_adjust</span></span>
<span><span class="co">## 1 0.6050407</span></span>
<span><span class="co">## 2 0.6050407</span></span>
<span><span class="co">## 3 0.6050407</span></span>
<span><span class="co">## 4 0.3703709</span></span>
<span><span class="co">## 5 0.6050407</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testMetadata</span><span class="op">(</span><span class="va">cp_faeces</span>, <span class="fl">2</span>, <span class="va">processedFaeces</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        Term   Estimate                                          CI    P_value</span></span>
<span><span class="co">## 1       BMI   2.722216 -4.56020479994157e-06 – 0.00544899180328022 0.05037851</span></span>
<span><span class="co">## 2 C.section  46.004176     -0.003866118532671 – 0.0958744696412498 0.07028311</span></span>
<span><span class="co">## 3  Secretor  -7.108612      -0.041559794510577 – 0.027342570748067 0.68370085</span></span>
<span><span class="co">## 4     Lewis -60.366832     -0.157987302185625 – 0.0372536372194021 0.22330820</span></span>
<span><span class="co">## 5    whz.6m   1.450616    -0.0115947217747149 – 0.0144959541369427 0.82617195</span></span>
<span><span class="co">##    P_adjust</span></span>
<span><span class="co">## 1 0.1757078</span></span>
<span><span class="co">## 2 0.1757078</span></span>
<span><span class="co">## 3 0.8261720</span></span>
<span><span class="co">## 4 0.3721803</span></span>
<span><span class="co">## 5 0.8261720</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="hm-microbiome">HM microbiome<a class="anchor" aria-label="anchor" href="#hm-microbiome"></a>
</h2>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testMetadata</span><span class="op">(</span><span class="va">cp_milk</span>, <span class="fl">1</span>, <span class="va">processedMilk</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        Term    Estimate                                         CI   P_value</span></span>
<span><span class="co">## 1       BMI  -0.7971158 -0.00356908227805278 – 0.00197485067980183 0.5702715</span></span>
<span><span class="co">## 2 C.section -27.2768492   -0.0779905182386613 – 0.0234368199177587 0.2891367</span></span>
<span><span class="co">## 3  Secretor   4.8853309    -0.0301641355434441 – 0.039934797247701 0.7830997</span></span>
<span><span class="co">## 4     Lewis  28.0599419     -0.071151776413022 – 0.127271660144112 0.5766273</span></span>
<span><span class="co">## 5    whz.6m   2.3991703    -0.0108741423856309 – 0.015672483059881 0.7211329</span></span>
<span><span class="co">##    P_adjust</span></span>
<span><span class="co">## 1 0.7830997</span></span>
<span><span class="co">## 2 0.7830997</span></span>
<span><span class="co">## 3 0.7830997</span></span>
<span><span class="co">## 4 0.7830997</span></span>
<span><span class="co">## 5 0.7830997</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testMetadata</span><span class="op">(</span><span class="va">cp_milk</span>, <span class="fl">2</span>, <span class="va">processedMilk</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        Term   Estimate                                         CI    P_value</span></span>
<span><span class="co">## 1       BMI   2.942392 0.000305899155017146 – 0.00557888463379954 0.02901701</span></span>
<span><span class="co">## 2 C.section  25.569124   -0.0226660263261727 – 0.0738042746886722 0.29612537</span></span>
<span><span class="co">## 3  Secretor   6.165320   -0.0271711809286324 – 0.0395018213417433 0.71494998</span></span>
<span><span class="co">## 4     Lewis -74.787457    -0.169150421245261 – 0.0195755080850167 0.11927081</span></span>
<span><span class="co">## 5    whz.6m  -3.204212  -0.0158288212471368 – 0.00942039651018406 0.61630886</span></span>
<span><span class="co">##    P_adjust</span></span>
<span><span class="co">## 1 0.1450850</span></span>
<span><span class="co">## 2 0.4935423</span></span>
<span><span class="co">## 3 0.7149500</span></span>
<span><span class="co">## 4 0.2981770</span></span>
<span><span class="co">## 5 0.7149500</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">topIndices</span> <span class="op">=</span> <span class="va">processedMilk</span><span class="op">$</span><span class="va">mode2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>index<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, Comp <span class="op">=</span> <span class="va">cp_milk</span><span class="op">$</span><span class="va">Fac</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">Comp</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">bottomIndices</span> <span class="op">=</span> <span class="va">processedMilk</span><span class="op">$</span><span class="va">mode2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>index<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, Comp <span class="op">=</span> <span class="va">cp_milk</span><span class="op">$</span><span class="va">Fac</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">Comp</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Xhat</span> <span class="op">=</span> <span class="fu">parafac4microbiome</span><span class="fu">::</span><span class="fu"><a href="../reference/reinflateTensor.html">reinflateTensor</a></span><span class="op">(</span><span class="va">cp_milk</span><span class="op">$</span><span class="va">Fac</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="va">cp_milk</span><span class="op">$</span><span class="va">Fac</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="va">cp_milk</span><span class="op">$</span><span class="va">Fac</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Positive loadings:"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Positive loadings:"</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">Xhat</span><span class="op">[</span>,<span class="va">topIndices</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">processedMilk</span><span class="op">$</span><span class="va">mode1</span><span class="op">$</span><span class="va">BMI</span><span class="op">)</span><span class="op">)</span> <span class="co"># no flip</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.1705408</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Negative loadings:"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Negative loadings:"</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">Xhat</span><span class="op">[</span>,<span class="va">bottomIndices</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">processedMilk</span><span class="op">$</span><span class="va">mode1</span><span class="op">$</span><span class="va">BMI</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -0.1705408</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">=</span> <span class="va">processedMilk</span><span class="op">$</span><span class="va">mode1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Component_2 <span class="op">=</span> <span class="va">cp_milk</span><span class="op">$</span><span class="va">Fac</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">BMI</span>,y<span class="op">=</span><span class="va">Component_2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/stat_cor.html" class="external-link">stat_cor</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"ppBMI"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Loading"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">16</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">=</span> <span class="va">processedMilk</span><span class="op">$</span><span class="va">mode2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Component_2 <span class="op">=</span> <span class="va">cp_milk</span><span class="op">$</span><span class="va">Fac</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">Component_2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>index<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Genus <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"g__"</span>, <span class="st">""</span>, <span class="va">V7</span><span class="op">)</span>, Species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"s__"</span>, <span class="st">""</span>, <span class="va">V8</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split_fixed</a></span><span class="op">(</span><span class="va">Species</span>, <span class="st">"_"</span>, <span class="fl">2</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="va">Species</span>, .fns <span class="op">=</span> <span class="op">~</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"sp."</span><span class="op">)</span>, <span class="st">""</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="va">Species</span>, .fns <span class="op">=</span> <span class="op">~</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"organism"</span><span class="op">)</span>, <span class="st">""</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="va">Species</span>, .fns <span class="op">=</span> <span class="op">~</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"bacterium"</span><span class="op">)</span>, <span class="st">""</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">index</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">106</span><span class="op">:</span><span class="fl">115</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">Genus</span> <span class="op">==</span> <span class="st">""</span> <span class="op">&amp;</span> <span class="va">df</span><span class="op">$</span><span class="va">Species</span> <span class="op">==</span> <span class="st">""</span>, <span class="st">"Species"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Unknown"</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">Species</span> <span class="op">==</span> <span class="st">""</span>, <span class="st">"Species"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"sp."</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Genus</span>, <span class="st">" "</span>, <span class="va">df</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">b</span> <span class="op">=</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Component_2</span>,y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span>,fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">V3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Loading"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_y_discrete</a></span><span class="op">(</span>labels<span class="op">=</span><span class="va">df</span><span class="op">$</span><span class="va">name</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Phylum"</span>, values<span class="op">=</span><span class="fu"><a href="https://scales.r-lib.org/reference/pal_hue.html" class="external-link">hue_pal</a></span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span>, labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Actinobacteriota"</span>, <span class="st">"Firmicutes"</span>, <span class="st">"Proteobacteria"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">16</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">c</span> <span class="op">=</span> <span class="va">cp_milk</span><span class="op">$</span><span class="va">Fac</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>value<span class="op">=</span><span class="va">value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">30</span>,<span class="fl">60</span>,<span class="fl">90</span><span class="op">)</span>,y<span class="op">=</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time point [day]"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Loading"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">16</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">a</span></span></code></pre></div>
<p><img src="MAINHEALTH_files/figure-html/cp%20HM%20milk%20comp%202-1.png" width="700"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span></span></code></pre></div>
<p><img src="MAINHEALTH_files/figure-html/cp%20HM%20milk%20comp%202-2.png" width="700"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c</span></span></code></pre></div>
<p><img src="MAINHEALTH_files/figure-html/cp%20HM%20milk%20comp%202-3.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="hm-metabolome">HM metabolome<a class="anchor" aria-label="anchor" href="#hm-metabolome"></a>
</h2>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testMetadata</span><span class="op">(</span><span class="va">cp_milkMetab</span>, <span class="fl">1</span>, <span class="va">processedMilkMetab</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        Term  Estimate                                          CI    P_value</span></span>
<span><span class="co">## 1       BMI -2.583661 -0.00535718628987143 – 0.000189863674592802 0.06760372</span></span>
<span><span class="co">## 2 C.section -9.956381    -0.0605921878622612 – 0.0406794268355845 0.69782750</span></span>
<span><span class="co">## 3  Secretor  9.252236    -0.0261442697993304 – 0.0446487419625543 0.60584696</span></span>
<span><span class="co">## 4     Lewis 92.519158     -0.0281341347345387 – 0.213172450952438 0.13163311</span></span>
<span><span class="co">## 5    whz.6m 10.497357   -0.00275014531882957 – 0.0237448598441314 0.11934771</span></span>
<span><span class="co">##    P_adjust</span></span>
<span><span class="co">## 1 0.2193885</span></span>
<span><span class="co">## 2 0.6978275</span></span>
<span><span class="co">## 3 0.6978275</span></span>
<span><span class="co">## 4 0.2193885</span></span>
<span><span class="co">## 5 0.2193885</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testMetadata</span><span class="op">(</span><span class="va">cp_milkMetab</span>, <span class="fl">2</span>, <span class="va">processedMilkMetab</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        Term    Estimate                                        CI      P_value</span></span>
<span><span class="co">## 1       BMI   0.1116855 -0.00080493346242961 – 0.0010283045137446 8.098366e-01</span></span>
<span><span class="co">## 2 C.section  11.0721065 -0.00566246154228743 – 0.0278066745141615 1.927839e-01</span></span>
<span><span class="co">## 3  Secretor 177.1666463     0.165468496949462 – 0.188864795602086 6.443800e-59</span></span>
<span><span class="co">## 4     Lewis -37.4429441 -0.0773175080477337 – 0.00243161979792261 6.545970e-02</span></span>
<span><span class="co">## 5    whz.6m   1.6165731 -0.0027615783945977 – 0.00599472449699943 4.662904e-01</span></span>
<span><span class="co">##       P_adjust</span></span>
<span><span class="co">## 1 8.098366e-01</span></span>
<span><span class="co">## 2 3.213065e-01</span></span>
<span><span class="co">## 3 3.221900e-58</span></span>
<span><span class="co">## 4 1.636492e-01</span></span>
<span><span class="co">## 5 5.828630e-01</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testMetadata</span><span class="op">(</span><span class="va">cp_milkMetab</span>, <span class="fl">3</span>, <span class="va">processedMilkMetab</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        Term   Estimate                                          CI   P_value</span></span>
<span><span class="co">## 1       BMI  -1.716400 -0.00415552494908338 – 0.000722724998462952 0.1661829</span></span>
<span><span class="co">## 2 C.section -22.466123    -0.0669968421278869 – 0.0220645963398689 0.3199733</span></span>
<span><span class="co">## 3  Secretor  -6.672137    -0.0378009361212165 – 0.0244566617238421 0.6721456</span></span>
<span><span class="co">## 4     Lewis -22.466704     -0.128572999236914 – 0.0836395906101599 0.6758950</span></span>
<span><span class="co">## 5    whz.6m   3.066525   -0.00858374497479842 – 0.0147167946587828 0.6033337</span></span>
<span><span class="co">##   P_adjust</span></span>
<span><span class="co">## 1 0.675895</span></span>
<span><span class="co">## 2 0.675895</span></span>
<span><span class="co">## 3 0.675895</span></span>
<span><span class="co">## 4 0.675895</span></span>
<span><span class="co">## 5 0.675895</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">topIndices</span> <span class="op">=</span> <span class="va">processedMilkMetab</span><span class="op">$</span><span class="va">mode2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>index<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, Comp <span class="op">=</span> <span class="va">cp_milkMetab</span><span class="op">$</span><span class="va">Fac</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">Comp</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">bottomIndices</span> <span class="op">=</span> <span class="va">processedMilkMetab</span><span class="op">$</span><span class="va">mode2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>index<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, Comp <span class="op">=</span> <span class="va">cp_milkMetab</span><span class="op">$</span><span class="va">Fac</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">Comp</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Xhat</span> <span class="op">=</span> <span class="fu">parafac4microbiome</span><span class="fu">::</span><span class="fu"><a href="../reference/reinflateTensor.html">reinflateTensor</a></span><span class="op">(</span><span class="va">cp_milkMetab</span><span class="op">$</span><span class="va">Fac</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="va">cp_milkMetab</span><span class="op">$</span><span class="va">Fac</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="va">cp_milkMetab</span><span class="op">$</span><span class="va">Fac</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Positive loadings:"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Positive loadings:"</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">Xhat</span><span class="op">[</span>,<span class="va">topIndices</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">processedMilkMetab</span><span class="op">$</span><span class="va">mode1</span><span class="op">$</span><span class="va">Secretor</span><span class="op">)</span><span class="op">)</span> <span class="co"># flip</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -0.9257706</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Negative loadings:"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Negative loadings:"</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">Xhat</span><span class="op">[</span>,<span class="va">bottomIndices</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">processedMilkMetab</span><span class="op">$</span><span class="va">mode1</span><span class="op">$</span><span class="va">Secretor</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.9257706</span></span></code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">=</span> <span class="va">processedMilkMetab</span><span class="op">$</span><span class="va">mode1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Component_2 <span class="op">=</span> <span class="va">cp_milkMetab</span><span class="op">$</span><span class="va">Fac</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">Secretor</span><span class="op">)</span>,y<span class="op">=</span><span class="va">Component_2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/stat_compare_means.html" class="external-link">stat_compare_means</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Secretor status"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Loading"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Se-"</span>, <span class="st">"Se+"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">16</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp</span> <span class="op">=</span> <span class="va">processedMilkMetab</span><span class="op">$</span><span class="va">mode2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Component_2 <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">*</span><span class="va">cp_milkMetab</span><span class="op">$</span><span class="va">Fac</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">Component_2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>index<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">index</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">61</span><span class="op">:</span><span class="fl">70</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b</span><span class="op">=</span><span class="va">temp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Component_2</span>,y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span>,fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">Class</span><span class="op">)</span>,pattern<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">Class</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://trevorldavis.com/R/ggpattern/reference/geom-docs.html" class="external-link">geom_bar_pattern</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>,</span>
<span>                   colour<span class="op">=</span><span class="st">"black"</span>,</span>
<span>                   pattern<span class="op">=</span><span class="st">"stripe"</span>,</span>
<span>                   pattern_fill<span class="op">=</span><span class="st">"black"</span>,</span>
<span>                   pattern_density<span class="op">=</span><span class="fl">0.2</span>,</span>
<span>                   pattern_spacing<span class="op">=</span><span class="fl">0.05</span>,</span>
<span>                   pattern_angle<span class="op">=</span><span class="fl">45</span>,</span>
<span>                   pattern_size<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_y_discrete</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">temp</span><span class="op">$</span><span class="va">Metabolite</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Loading"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Class"</span>, values<span class="op">=</span><span class="fu"><a href="https://scales.r-lib.org/reference/pal_hue.html" class="external-link">hue_pal</a></span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="fl">7</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span>, labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Amino acids and derivatives"</span>, <span class="st">"Energy related"</span>, <span class="st">"Fatty acids and derivatives"</span>, <span class="st">"Oligosaccharides"</span>, <span class="st">"Sugars"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">16</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">c</span> <span class="op">=</span> <span class="va">cp_milkMetab</span><span class="op">$</span><span class="va">Fac</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>value<span class="op">=</span><span class="va">value</span><span class="op">*</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">30</span>,<span class="fl">60</span>,<span class="fl">90</span><span class="op">)</span>,y<span class="op">=</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time point [day]"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Loading"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">16</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">a</span></span></code></pre></div>
<p><img src="MAINHEALTH_files/figure-html/cp%20milkMetab%20comp%202-1.png" width="700"></p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span></span></code></pre></div>
<p><img src="MAINHEALTH_files/figure-html/cp%20milkMetab%20comp%202-2.png" width="700"></p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c</span></span></code></pre></div>
<p><img src="MAINHEALTH_files/figure-html/cp%20milkMetab%20comp%202-3.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Geert Roelof van der Ploeg, University of Amsterdam.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
